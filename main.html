<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nuestro Compromiso Interbank 2026</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh; /* Usar min-height para que funcione en pantallas pequeñas */
      color: #333;
    }
    .container {
      background: #fff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 550px; /* Aumentado ligeramente para mejor visualización */
    }
    h1 {
      color: #009a44;
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
    }
    input,
    select,
    textarea {
      width: 100%;
      margin-top: 6px;
      margin-bottom: 16px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      box-sizing: border-box; /* Asegura que padding no afecte el ancho total */
    }
    button {
      width: 100%;
      background: #009a44;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #007b37;
    }
    .instrucciones {
      background: #e6f4ec;
      padding: 15px;
      border-radius: 12px;
      margin-top: 15px;
      font-size: 14px;
      line-height: 1.5;
    }
    /* Estilos del Acróstico */
    #acrostico {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    .letra {
      width: 60px;
      height: 60px;
      background: #d9f5e5;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 32px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.3s ease, background 0.3s ease;
      color: #009a44; /* Color inicial de la letra */
    }
    .letra:hover {
      transform: scale(1.15);
    }
    .letra.completa {
      background: #009a44;
      color: white;
      transform: scale(1.1) rotate(3deg);
    }

    /* Estilos de la pantalla final */
    #final .content-wrapper {
      display: flex;
      flex-direction: column; /* Cambiar a columna en pantallas pequeñas */
      align-items: center;
      margin-top: 20px;
      gap: 30px;
    }
    #resultadoFinal {
      font-size: 16px;
      line-height: 2;
      text-align: left;
      min-width: 200px;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    #camara {
      width: 100%;
      max-width: 250px;
      height: 200px;
      background: #000;
      border-radius: 8px;
      object-fit: cover;
    }
    /* Media query para pantallas más grandes (desktops) */
    @media (min-width: 600px) {
      #final .content-wrapper {
        flex-direction: row;
        align-items: flex-start;
        justify-content: space-around;
      }
      #camara {
        height: 320px;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="inicio">
    <h1>Juego Interbank 2026</h1>
    <label for="representante">Nombre del representante:</label>
    <input
      type="text"
      id="representante"
      placeholder="Ingresa tu nombre"
    />

    <label for="equipo">Nombre del equipo:</label>
    <input
      type="text"
      id="equipo"
      placeholder="Ej: Los Visionarios"
    />

    <label for="vp">Selecciona tu VP:</label>
    <select id="vp">
      <option value="Finanzas">VP Finanzas</option>
      <option value="GDH">VP GDH</option>
      <option value="Operaciones">VP Operaciones</option>
      <option value="Comercial">VP Comercial</option>
    </select>

    <button onclick="startGame()">Ingresar al juego</button>

    <div class="instrucciones">
      <strong>Instrucciones:</strong><br />
      Este juego es un acróstico con colores Interbank. Tu equipo deberá formar la palabra
      <strong>INTERBANK</strong> y completar su compromiso como equipo al 2026, asegurándose de que cada frase
      empiece con la letra asignada.
    </div>
  </div>

  <div class="container" id="juego" style="display: none; text-align: center">
    <h1 style="color: #009a44">Acróstico INTERBANK</h1>
    <p id="bienvenidaMsg"></p>

    <div id="acrostico" style="margin-top: 20px">
      <div class="letra" data-letter="I">I</div>
      <div class="letra" data-letter="N1">N</div>
      <div class="letra" data-letter="T">T</div>
      <div class="letra" data-letter="E">E</div>
      <div class="letra" data-letter="R">R</div>
      <div class="letra" data-letter="B">B</div>
      <div class="letra" data-letter="A">A</div>
      <div class="letra" data-letter="N2">N</div>
      <div class="letra" data-letter="K">K</div>
    </div>

    <p style="margin-top: 15px; font-size: 14px">
      Haz clic en cada letra para completar el compromiso 2026.
    </p>

    <div id="editor" style="margin-top: 20px; display: none">
      <h3 id="editorTitulo" style="color: #333; margin-bottom: 10px;"></h3>
      <textarea
        id="textoLetra"
        style="width: 100%; height: 80px; border-radius: 10px; padding: 10px"
        placeholder="Escribe el compromiso que inicia con esta letra..."
      ></textarea>
      <button style="margin-top: 10px" onclick="guardarLetra()">Guardar Compromiso</button>
    </div>
  </div>

  <div class="container" id="final" style="display: none; text-align: center">
    <h1 style="color: #009a44">¡Compromiso 2026 Completado!</h1>
    <p>
      **Equipo <span id="equipoFinal"></span>** de **VP <span id="vpFinal"></span>**
    </p>

    <div class="content-wrapper">
      <div id="resultadoFinal">
        </div>

      <div style="display: flex; flex-direction: column; align-items: center">
        <video
          id="camara"
          autoplay
          playsinline
        ></video>

        <button onclick="tomarFoto()" style="margin-top: 10px; max-width: 250px">
          Tomar foto
        </button>
        
        <canvas id="fotoCanvas" style="display: none"></canvas>

        <img
          id="fotoTomada"
          style="
            margin-top: 15px;
            width: 100%;
            max-width: 250px;
            display: none;
            border-radius: 8px;
            border: 2px solid #009a44;
          "
          alt="Foto del equipo"
        />
      </div>
    </div>

    <button onclick="volverAlJuego()" style="margin-top: 30px; background: #333;">
      Volver a editar
    </button>
  </div>

  <script>
    // Almacenamiento de datos del juego
    const compromisos = {};
    let letraActiva = null;
    let equipoData = {};

    function startGame() {
      const rep = document.getElementById('representante').value.trim();
      const eq = document.getElementById('equipo').value.trim();
      const vp = document.getElementById('vp').value;

      if (!rep || !eq) {
        alert("Por favor completa tu nombre de representante y el nombre del equipo antes de continuar.");
        return;
      }

      // Guardar datos del equipo globalmente
      equipoData = { rep, eq, vp };

      // Ocultar inicio y mostrar juego
      document.getElementById('inicio').style.display = 'none';
      document.getElementById('juego').style.display = 'block';
      document.getElementById('bienvenidaMsg').innerHTML = `**${rep}**, completa el compromiso de tu equipo **${eq}** (${vp}).`;

      // Asegurar que el botón de finalizar no esté visible al inicio del juego
      const btnFinalizar = document.getElementById('btnFinalizar');
      if (btnFinalizar) btnFinalizar.remove();
    }

    // Manejar clics en las letras
    document.querySelectorAll('.letra').forEach(l => {
      l.addEventListener('click', () => {
        letraActiva = l.dataset.letter;
        const letraReal = letraActiva.replace(/[0-9]/g, "").toUpperCase();

        document.getElementById('editor').style.display = 'block';
        document.getElementById('editorTitulo').innerText = `Compromiso para la letra "${letraReal}"`;
        document.getElementById('textoLetra').value = compromisos[letraActiva] || "";
        document.getElementById('textoLetra').focus();
      });
    });

    // Guardar el texto del compromiso
    function guardarLetra() {
      const texto = document.getElementById('textoLetra').value.trim();
      if (!texto) {
        alert("Escribe un compromiso para esta letra.");
        return;
      }

      const letraReal = letraActiva.replace(/[0-9]/g, "").toUpperCase();

      // Validación: verificar que el texto empiece con esa letra
      if (!texto.toUpperCase().startsWith(letraReal)) {
        alert(`Tu compromiso debe empezar con la letra "${letraReal}".`);
        return;
      }

      // Guardar compromiso
      compromisos[letraActiva] = texto;

      // marcar letra como completa visualmente
      const letraDiv = [...document.querySelectorAll('.letra')].find(l => l.dataset.letter === letraActiva);
      letraDiv.classList.add('completa');

      document.getElementById('editor').style.display = 'none';

      checkCompleto();
    }

    // Verificar si todas las letras están completas
    function checkCompleto() {
      const orden = ["I", "N1", "T", "E", "R", "B", "A", "N2", "K"];
      const completo = orden.every(l => compromisos[l]);

      let btnFinalizar = document.getElementById('btnFinalizar');

      if (completo && !btnFinalizar) {
        // Crear el botón de finalizar si todas las letras están completas
        btnFinalizar = document.createElement('button');
        btnFinalizar.id = 'btnFinalizar';
        btnFinalizar.innerText = '¡Todo Listo! Ver Resumen y Foto';
        btnFinalizar.style.marginTop = '25px';
        btnFinalizar.onclick = mostrarResumenFinal;
        document.getElementById('juego').appendChild(btnFinalizar);
      } else if (!completo && btnFinalizar) {
        // Ocultar el botón si alguna letra es borrada/editada y ya no está completa
        btnFinalizar.remove();
      }
    }

    // Mostrar pantalla final
    function mostrarResumenFinal() {
      document.getElementById('juego').style.display = 'none';
      document.getElementById('final').style.display = 'block';

      // Actualizar datos del equipo en la pantalla final
      document.getElementById('equipoFinal').innerText = equipoData.eq;
      document.getElementById('vpFinal').innerText = equipoData.vp;


      const orden = ["I", "N1", "T", "E", "R", "B", "A", "N2", "K"];
      let html = "";

      // Generar el resumen del acróstico
      orden.forEach(l => {
        const letraReal = l.replace(/[0-9]/g, "").toUpperCase();
        html += `<strong style="color: #007b37;">${letraReal}</strong>: ${compromisos[l]}<br>`;
      });

      document.getElementById('resultadoFinal').innerHTML = html;
      
      // Iniciar la cámara
      activarCamara();
    }

    // Activar cámara
    function activarCamara() {
      const video = document.getElementById("camara");
      
      // Asegurar que la imagen tomada previamente no esté visible
      document.getElementById("fotoTomada").style.display = "none";
      video.style.display = "block"; // Mostrar el video

      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(stream => {
            // Detener cualquier stream anterior (si lo hubiera)
            if (video.srcObject) {
                const tracks = video.srcObject.getTracks();
                tracks.forEach(track => track.stop());
            }
            video.srcObject = stream;
          })
          .catch(err => {
            alert("No se pudo acceder a la cámara. Por favor, asegúrate de haber dado permiso. Error: " + err.name);
            video.style.display = "none"; // Ocultar el reproductor si falla
          });
      } else {
          alert("Tu navegador no soporta el acceso a la cámara.");
          video.style.display = "none";
      }
    }

    // Tomar foto
    function tomarFoto() {
      const video = document.getElementById("camara");
      const canvas = document.getElementById("fotoCanvas");
      const img = document.getElementById("fotoTomada");

      if (video.readyState !== 4) { // readyState 4 significa que el video está listo
        alert("La cámara no está lista o no fue activada correctamente.");
        return;
      }

      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      const ctx = canvas.getContext("2d");
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      img.src = canvas.toDataURL("image/png");
      img.style.display = "block";
      
      // Opcional: Pausar el video stream después de tomar la foto
      // video.pause(); 
    }

    // Volver a editar
    function volverAlJuego() {
      document.getElementById('final').style.display = 'none';
      document.getElementById('juego').style.display = 'block';

      // Detener el stream de la cámara al volver a la pantalla de edición
      const video = document.getElementById("camara");
      if (video.srcObject) {
        const tracks = video.srcObject.getTracks();
        tracks.forEach(track => track.stop());
        video.srcObject = null;
      }
    }
  </script>
</body>
</html>